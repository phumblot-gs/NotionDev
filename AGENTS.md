# AGENTS.md - notion_dev-project

*Generated by NotionDev on 2025-12-26 19:26*

## Project Overview

NotionDev is a Python CLI tool that integrates Notion, Asana, and Git for developers. It streamlines development workflows by automatically loading feature specifications from Notion into AI coding assistants while synchronizing with Asana tickets.

**Current Context:**
- **Project**: notion_dev-project
- **Active Module**: NotionDev
- **Active Feature**: ND01 - Commandes CLI
- **Status**: Validated
- **Current Task**: 1212596341628498 - ND01 - Créer et modifier des tickets Asana via MCP

## Build and Test Commands

### Development Commands
```bash
# Run CLI in development mode
python -m notion_dev.cli.main

# List Asana tickets
python -m notion_dev.cli.main tickets

# Start working on a ticket
python -m notion_dev.cli.main work TASK-123456789

# Generate AI context
python -m notion_dev.cli.main context

# Interactive mode
python -m notion_dev.cli.main interactive
```

### Testing
```bash
# Run unit tests
pytest tests/unit -v

# Install for testing
chmod +x install_notion_dev.sh
./install_notion_dev.sh
~/notion-dev-install/test_config.sh
```

## Architecture and Current Module

### Module: NotionDev
CLI et serveur MCP pour l'intégration Notion ↔ Asana ↔ Git

### Module Documentation
# NotionDev

## Objective

NotionDev est un outil CLI Python qui intègre **Notion**, **Asana** et **Git** pour les développeurs. Il met en œuvre une méthodologie **specs-first** où toutes les spécifications fonctionnelles sont documentées dans Notion AVANT de coder.

### Fonctionnalités principales

- **Synchronisation Notion → Code** : Charge automatiquement les spécifications des features depuis Notion vers `AGENTS.md`

- **Intégration Asana** : Liste et gère les tickets assignés avec filtrage par portfolio

- **Contexte IA** : Génère du contexte pour les assistants IA (Claude, Cursor, etc.)

- **Traçabilité** : Lie le code aux spécifications via des codes feature (ex: CC01, API02)

- **Serveur MCP** : Expose les fonctionnalités à Claude Code via Model Context Protocol

## Stack Technique

- **Langage** : Python 3.9+

- **CLI Framework** : Click 8.1+

- **Terminal UI** : Rich 13.7+

- **API Notion** : notion-client 2.2+

- **API Asana** : requests (client HTTP custom)

- **Git** : GitPython 3.1+

- **Configuration** : PyYAML 6.0+

- **MCP Server** : mcp (FastMCP) - Python 3.10+

## Architecture

```plain text
notion_dev/
├── __init__.py              # Package init avec setup.py embarqué
├── cli/
│   └── main.py              # Commandes Click et UI Rich
├── core/
│   ├── asana_client.py      # Client Asana (requests)
│   ├── config.py            # Gestion YAML avec dataclasses
│   ├── context_builder.py   # Génération contexte AGENTS.md
│   ├── models.py            # Modèles (Module, Feature, AsanaTask)
│   └── notion_client.py     # Client Notion (SDK officiel)
├── mcp_server/
│   └── server.py            # Serveur MCP (FastMCP)
└── requirements.txt
```

### Flux de données

1. **Asana** → Tickets assignés avec code feature

1. **Notion** → Spécifications modules et features

1. **NotionDev** → Agrège et formate le contexte

1. **AGENTS.md** → Fichier de contexte pour l'IA

## Configuration

### Fichier de configuration

Chemin : `~/.notion-dev/config.yml`

```yaml
notion:
  token: "secret_XXX"
  database_modules_id: "xxx-xxx-xxx"
  database_features_id: "xxx-xxx-xxx"

asana:
  access_token: "1/xxx:xxx"
  workspace_gid: "123456789"
  user_gid: "123456789"
  portfolio_gid: "123456789"  # Optionnel

logging:
  level: INFO
  file: notion-dev.log
```

### Variables d'environnement

## Logging

- **Fichier** : `~/.notion-dev/notion-dev.log`

- **Rotation** : 10MB max, 5 backups

- **Console** : Erreurs uniquement

## Liens utiles

- [Documentation Notion API](https://developers.notion.com/)

- [Documentation Asana API](https://developers.asana.com/docs)

- [Model Context Protocol](https://modelcontextprotocol.io/)

## Current Feature Context

⚠️ **IMPORTANT**: You are working on a specific feature within a larger codebase. Follow isolation rules to prevent regressions.

### Feature Scope
- **Feature Code**: ND01
- **Feature Name**: Commandes CLI
- **Module**: NotionDev
- **Status**: Validated

### Regression Prevention Rules

**MANDATORY**: To prevent regressions across the codebase:

1. **Feature Isolation**: Work ONLY on feature **ND01**
2. **File Headers Check**: Every file has a header indicating which feature it implements
3. **Modification Rules**:
   - ✅ CREATE new files: MUST add the header for feature ND01
   - ✅ MODIFY files: ONLY if header contains feature ND01
   - ❌ NEVER modify files with different feature codes
   - ❌ NEVER remove or alter existing feature headers

### Feature Specifications
# Feature ND01 - Commandes CLI

**Status:** Validated
**Module:** NotionDev

## Feature Documentation

## Exemples d'utilisation

### Workflow typique

```bash
# 1. Voir les tickets disponibles
notion-dev tickets

# 2. Commencer à travailler sur un ticket
notion-dev work 1234567890123456

# 3. (Développer avec l'assistant IA qui lit AGENTS.md)

# 4. Ajouter un commentaire de progression
notion-dev comment "PR créée, en attente de review"

# 5. Terminer le travail
notion-dev done
```

### Créer un ticket

```bash
# Créer un ticket simple
notion-dev create-ticket --name "ND01 - Fix bug login"

# Créer un ticket complet
notion-dev create-ticket \
  --name "CC01 - Nouvelle feature" \
  --feature CC01 \
  --notes "Description détaillée..." \
  --due 2025-01-30
```

### Intégration CI/CD

```bash
# Obtenir les infos en JSON pour parsing
notion-dev info --json | jq '.current_task.feature_code'

# Créer un ticket en JSON
notion-dev create-ticket --name "Auto ticket" --json
```

# Commandes CLI NotionDev

## Description

Interface en ligne de commande permettant de gérer le workflow de développement specs-first. Les commandes permettent de lister les tickets Asana, charger les spécifications Notion, et générer le contexte pour les assistants IA.

## Commandes disponibles

### notion-dev info

Affiche les informations du projet courant et du ticket en cours.

```bash
notion-dev info [--json]
```

**Options :**

- `--json` : Sortie en format JSON

**Informations affichées :**

- Nom et chemin du projet

- Configuration Notion/Asana

- Ticket en cours de travail (si existant)

---

### notion-dev tickets

Liste les tickets Asana assignés à l'utilisateur.

```bash
notion-dev tickets [--json]
```

**Options :**

- `--json` : Sortie en format JSON

**Comportement :**

- Si un portfolio est configuré : tickets groupés par projet

- Sinon : liste simple de tous les tickets

- Affiche : ID, nom, code feature, statut

---

### notion-dev work <TASK_ID>

Démarre le travail sur un ticket spécifique.

```bash
notion-dev work 1234567890123456 [--yes]
```

**Options :**

- `--yes, -y` : Mode non-interactif, skip les confirmations (requis pour MCP/scripts)

**Actions effectuées :**

1. Charge le ticket depuis Asana

1. Extrait le code feature (ex: CC01)

1. Récupère les specs depuis Notion

1. Génère le fichier `AGENTS.md`

1. Ajoute un commentaire "is working on it" sur Asana

1. Si changement de ticket : ajoute "moves on to another task" à l'ancien

**Fichiers générés :**

- `AGENTS.md` : Contexte complet pour l'IA

- `.notion-dev/current_task.txt` : ID du ticket en cours

**Exemples :**

```bash
# Mode interactif (demande confirmation)
notion-dev work 1234567890123456

# Mode non-interactif (pour scripts/MCP)
notion-dev work 1234567890123456 --yes
```

---

### notion-dev comment <MESSAGE>

Ajoute un commentaire au ticket en cours.

```bash
notion-dev comment "Implémentation en cours, tests à finaliser"
```

**Prérequis :**

- Un ticket doit être en cours (`notion-dev work` exécuté avant)

---

### notion-dev done

Marque le travail comme terminé.

```bash
notion-dev done
```

**Actions effectuées :**

1. Ajoute le commentaire "work is done, waiting for approval"

1. Réassigne le ticket à son créateur

1. Supprime le fichier `current_task.txt`

---

### notion-dev context

Génère le contexte IA pour une feature spécifique.

```bash
notion-dev context [--feature CODE] [--yes]
```

**Options :**

- `--feature, -f` : Code de la feature (requis en mode non-interactif)

- `--yes, -y` : Mode non-interactif, skip les confirmations

**Exemples :**

```bash
# Mode interactif (demande le code feature et confirmation)
notion-dev context

# Spécifier la feature
notion-dev context --feature CC01

# Mode non-interactif (pour scripts/MCP)
notion-dev context -f CC01 --yes
```

---

### notion-dev create-ticket

Crée un nouveau ticket Asana.

```bash
notion-dev create-ticket --name "CC01 - Nouvelle fonctionnalité" [options]
```

**Options :**

- `--name, -n` (requis) : Titre du ticket

- `--feature, -f` : Code feature à référencer (ex: CC01)

- `--notes` : Description du ticket (markdown)

- `--due` : Date d'échéance (YYYY-MM-DD)

- `--json` : Sortie en format JSON

**Exemple :**

```bash
notion-dev create-ticket \
  --name "CC01 - Implémenter le login OAuth" \
  --feature CC01 \
  --notes "Ajouter le support OAuth2 pour Google et GitHub" \
  --due 2025-01-15
```

---

### notion-dev update-ticket <TASK_ID>

Met à jour un ticket Asana existant.

```bash
notion-dev update-ticket 1234567890123456 [options]
```

**Options :**

- `--name, -n` : Nouveau titre

- `--notes` : Nouveau contenu (remplace par défaut)

- `--append` : Ajouter aux notes existantes au lieu de remplacer

- `--due` : Nouvelle date d'échéance (YYYY-MM-DD)

- `--assignee` : Nouvel assigné (GID Asana)

- `--json` : Sortie en format JSON

**Exemples :**

```bash
# Modifier le titre
notion-dev update-ticket 123456 --name "CC01 - Nouveau titre"

# Ajouter du contenu aux notes
notion-dev update-ticket 123456 --notes "## Update\nNouvelle section" --append

# Changer la date d'échéance
notion-dev update-ticket 123456 --due 2025-02-01
```

---

### notion-dev interactive

Lance le mode interactif avec menu.

```bash
notion-dev interactive
```

Below the documentation of Module: NotionDev

# NotionDev

## Objective

NotionDev est un outil CLI Python qui intègre **Notion**, **Asana** et **Git** pour les développeurs. Il met en œuvre une méthodologie **specs-first** où toutes les spécifications fonctionnelles sont documentées dans Notion AVANT de coder.

### Fonctionnalités principales

- **Synchronisation Notion → Code** : Charge automatiquement les spécifications des features depuis Notion vers `AGENTS.md`

- **Intégration Asana** : Liste et gère les tickets assignés avec filtrage par portfolio

- **Contexte IA** : Génère du contexte pour les assistants IA (Claude, Cursor, etc.)

- **Traçabilité** : Lie le code aux spécifications via des codes feature (ex: CC01, API02)

- **Serveur MCP** : Expose les fonctionnalités à Claude Code via Model Context Protocol

## Stack Technique

- **Langage** : Python 3.9+

- **CLI Framework** : Click 8.1+

- **Terminal UI** : Rich 13.7+

- **API Notion** : notion-client 2.2+

- **API Asana** : requests (client HTTP custom)

- **Git** : GitPython 3.1+

- **Configuration** : PyYAML 6.0+

- **MCP Server** : mcp (FastMCP) - Python 3.10+

## Architecture

```plain text
notion_dev/
├── __init__.py              # Package init avec setup.py embarqué
├── cli/
│   └── main.py              # Commandes Click et UI Rich
├── core/
│   ├── asana_client.py      # Client Asana (requests)
│   ├── config.py            # Gestion YAML avec dataclasses
│   ├── context_builder.py   # Génération contexte AGENTS.md
│   ├── models.py            # Modèles (Module, Feature, AsanaTask)
│   └── notion_client.py     # Client Notion (SDK officiel)
├── mcp_server/
│   └── server.py            # Serveur MCP (FastMCP)
└── requirements.txt
```

### Flux de données

1. **Asana** → Tickets assignés avec code feature

1. **Notion** → Spécifications modules et features

1. **NotionDev** → Agrège et formate le contexte

1. **AGENTS.md** → Fichier de contexte pour l'IA

## Configuration

### Fichier de configuration

Chemin : `~/.notion-dev/config.yml`

```yaml
notion:
  token: "secret_XXX"
  database_modules_id: "xxx-xxx-xxx"
  database_features_id: "xxx-xxx-xxx"

asana:
  access_token: "1/xxx:xxx"
  workspace_gid: "123456789"
  user_gid: "123456789"
  portfolio_gid: "123456789"  # Optionnel

logging:
  level: INFO
  file: notion-dev.log
```

### Variables d'environnement

## Logging

- **Fichier** : `~/.notion-dev/notion-dev.log`

- **Rotation** : 10MB max, 5 backups

- **Console** : Erreurs uniquement

## Liens utiles

- [Documentation Notion API](https://developers.notion.com/)

- [Documentation Asana API](https://developers.asana.com/docs)

- [Model Context Protocol](https://modelcontextprotocol.io/)

## Code Standards

### Mandatory File Headers

Every new file you create MUST start with:
```
/**
 * NOTION FEATURES: ND01
 * MODULES: NotionDev
 * DESCRIPTION: [Brief description of file purpose]
 * LAST_SYNC: 2025-12-26
 */
```

### Before Modifying Existing Files
1. CHECK the file header for NOTION FEATURES
2. ONLY proceed if it contains "ND01"
3. If multiple features listed, ensure ND01 is included
4. NEVER modify if ND01 is not present

### Language Requirements
- **Documentation reading**: You may encounter documentation in various languages
- **Chat responses**: You may respond in the user's preferred language
- **Code and comments**: ALL code, comments, variable names, and function names MUST be in English

## Development Workflow

### Notion Integration
- Features are documented in Notion with detailed specifications
- Each feature has a unique code (e.g., ND01)
- Module documentation provides architectural context

### Asana Integration
- Tasks link to feature codes for traceability
- Use `notion-dev work TASK-ID` to start working on a task

### Git Integration
- Headers in code files ensure traceability
- Follow feature isolation to prevent regressions

## Security Considerations

- API tokens are stored in `~/.notion-dev/config.yml`
- Never commit sensitive configuration to repository
- Use environment variables for CI/CD deployments

## Project Information
- **Repository**: /Users/phf/notion_dev-project
- **Git Status**: Git repository
- **Cache Location**: /Users/phf/notion_dev-project/.notion-dev

---
*Generated by NotionDev - Keeping your code aligned with specifications*
